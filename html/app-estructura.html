<!DOCTYPE html>
<html lang="en" class="light-style layout-wide" dir="ltr" data-theme="theme-default" data-assets-path="../assets/" data-template="vertical-menu-template-free">

<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />
	<title>App - Sismo</title>
	<meta name="description" content="" />
	<!-- Fonts -->
	<link rel="preconnect" href="https://fonts.googleapis.com" />
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
	<link href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap" rel="stylesheet" />
	<!-- Core CSS -->
	<link rel="stylesheet" href="../assets/vendor/css/core.css" class="template-customizer-core-css" />
	<link rel="stylesheet" href="../assets/vendor/css/theme-default.css" class="template-customizer-theme-css" />
	<!-- Page CSS -->
	<!-- Helpers -->
	<script src="../assets/vendor/js/helpers.js"></script>
	<script src="../assets/js/config.js"></script>
</head>

<body>
	<div class="content-wrapper">
		<!-- Content -->
		<div class="container-xxl flex-grow-1 container-p-y">
			<!-- Basic Layout -->
			<div class="row">
				<div class="col-xl">
					<div class="card mb-4">
						<div class="card-header d-flex justify-content-between align-items-center">
							<h5 class="mb-0">Definición del modelo</h5>
						</div>
						<div class="card-body">
							<div class="row">
								<div class="row mb-3">
									<label class="col-sm-2 col-form-label">Pisos</label>
									<div class="col-sm-2">
										<input type="number" class="form-control floors" />
									</div>
								</div>
								<div class="row mb-3">
									<label class="col-sm-2 col-form-label">Columnas</label>
									<div class="col-sm-2">
										<input type="number" class="form-control columns" placeholder="Cantidad" />
									</div>
									<div class="col-sm-2">
										<input type="number" class="form-control columns-b" placeholder="B" min="0" />
									</div>
									<div class="col-sm-2">
										<input type="number" class="form-control columns-h" placeholder="H" />
									</div>
									<div class="col-sm-2">
										<input type="number" class="form-control columns-hc" placeholder="HC" />
									</div>
								</div>
								<div class="row mb-3">
									<label class="col-sm-2 col-form-label">Vigas</label>
									<div class="col-sm-2">
										<input type="number" class="form-control beams" placeholder="Cantidad" />
									</div>
									<div class="col-sm-2">
										<input type="number" class="form-control beams-b" placeholder="B" />
									</div>
									<div class="col-sm-2">
										<input type="number" class="form-control beams-h" placeholder="H" />
									</div>
									<div class="col-sm-2">
										<input type="number" class="form-control beams-lv" placeholder="LV" />
									</div>
								</div>
								<div class="row mb-3">
									<label class="col-sm-2 col-form-label">Muros de mampostería</label>
									<div class="col-sm-2">
										<input type="number" class="form-control walls" />
									</div>
									<div class="col-sm-2">
										<input type="number" class="form-control walls-lm" placeholder="LM" />
									</div>
									<div class="col-sm-2">
										<input type="number" class="form-control walls-hm" placeholder="HM" />
									</div>
									<div class="col-sm-2">
										<input type="number" class="form-control walls-em" placeholder="EM" />
									</div>
								</div>
								<div class="row mb-3">
									<label class="col-sm-2 col-form-label">Losas</label>
									<div class="col-sm-2">
										<input type="number" class="form-control slabs" />
									</div>
									<div class="col-sm-2">
										<input type="number" class="form-control slabs-ll" placeholder="LL" />
									</div>
									<div class="col-sm-2">
										<input type="number" class="form-control slabs-al" placeholder="AL" />
									</div>
									<div class="col-sm-2">
										<input type="number" class="form-control slabs-el" placeholder="EL" />
									</div>
								</div>
								<div class="row justify-content-end">
									<div class="col-sm-10">
										<button type="button" class="btn btn-primary define-model-btn">Confirmar</button>
										<button type="button" class="btn btn-info initialize-model-btn d-none">Inicializar</button>
										<button type="button" class="btn btn-primary calculate-model-btn">Simular</button>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="card mb-4 d-none data">
						<div class="card-header d-flex justify-content-between align-items-center">
							<h5 class="mb-0">Datos</h5>
						</div>
						<div class="card-body">
							<div class="row">
								<table class="table table-sm table-striped mb-3">
									<thead>
										<tr>
											<th>Nivel</th>
											<th>Columna</th>
											<th>b</th>
											<th>h</th>
											<th>Hc</th>
											<th>Viga Der.</th>
											<th>Viga Izq.</th>
											<th>Viga Arr.</th>
											<th>Viga Aba.</th>
											<th>Muro Der.</th>
											<th>Muro Izq.</th>
											<th>Muro Arr.</th>
											<th>Muro Aba.</th>
											<th>Losa</th>
										</tr>
									</thead>
									<tbody class="columns-tbl">
										<tr class="clone-target d-none">
											<td><select class="form-select form-select-sm cl-sl-f"></select></td>
											<td><input type="text" class="form-control form-control-sm column" /></td>
											<td><input type="number" class="form-control form-control-sm column-b" /></td>
											<td><input type="number" class="form-control form-control-sm column-h" /></td>
											<td><input type="number" class="form-control form-control-sm column-hc" /></td>
											<td><select class="form-select form-select-sm column-b-r cl-sl-b"></select></td>
											<td><select class="form-select form-select-sm column-b-l cl-sl-b"></select></td>
											<td><select class="form-select form-select-sm column-b-t cl-sl-b"></select></td>
											<td><select class="form-select form-select-sm column-b-b cl-sl-b"></select></td>
											<td><select class="form-select form-select-sm column-w-r cl-sl-w"></select></td>
											<td><select class="form-select form-select-sm column-w-l cl-sl-w"></select></td>
											<td><select class="form-select form-select-sm column-w-t cl-sl-w"></select></td>
											<td><select class="form-select form-select-sm column-w-b cl-sl-w"></select></td>
											<td><select class="form-select form-select-sm column-s cl-sl-s"></select></td>
										</tr>
									</tbody>
								</table>
								<table class="table table-sm table-striped mb-3">
									<thead>
										<tr>
											<th>Nivel</th>
											<th>Viga</th>
											<th>b</th>
											<th>h</th>
											<th>Lv</th>
										</tr>
									</thead>
									<tbody class="beams-tbl">
										<tr class="clone-target d-none">
											<td><select class="form-select form-select-sm bm-sl-f"></select></td>
											<td><input type="text" class="form-control form-control-sm beam" /></td>
											<td><input type="number" class="form-control form-control-sm beam-b" /></td>
											<td><input type="number" class="form-control form-control-sm beam-h" /></td>
											<td><input type="number" class="form-control form-control-sm beam-lv" /></td>
										</tr>
									</tbody>
								</table>
								<table class="table table-sm table-striped mb-3 d-none">
									<thead>
										<tr>
											<th>Nivel</th>
											<th>Muro de mampostería</th>
											<th>Lm</th>
											<th>Hm</th>
											<th>em</th>
										</tr>
									</thead>
									<tbody class="walls-tbl">
										<tr class="clone-target d-none">
											<td><select class="form-select form-select-sm wl-sl-f"></select></td>
											<td><input type="text" class="form-control form-control-sm wall" /></td>
											<td><input type="number" class="form-control form-control-sm wall-lm" /></td>
											<td><input type="number" class="form-control form-control-sm wall-hm" /></td>
											<td><input type="number" class="form-control form-control-sm wall-em" /></td>
										</tr>
									</tbody>
								</table>
								<table class="table table-sm table-striped mb-3">
									<thead>
										<tr>
											<th>Nivel</th>
											<th>Losa</th>
											<th>Ll</th>
											<th>Al</th>
											<th>el</th>
										</tr>
									</thead>
									<tbody class="slabs-tbl">
										<tr class="clone-target d-none">
											<td><select class="form-select form-select-sm sb-sl-f"></select></td>
											<td><input type="text" class="form-control form-control-sm slab" /></td>
											<td><input type="number" class="form-control form-control-sm slab-ll" /></td>
											<td><input type="number" class="form-control form-control-sm slab-al" /></td>
											<td><input type="number" class="form-control form-control-sm slab-el" /></td>
										</tr>
									</tbody>
								</table>
								<div class="row justify-content-end">
									<div class="col-sm-10">
										<button type="button" class="btn btn-primary calculate-model-btn">Simular</button>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="card mb-4 step-i d-none">
						<div class="card-header d-flex justify-content-between align-items-center">
							<h5 class="mb-0">Paso 1</h5>
						</div>
						<div class="card-body">
							<table class="table table-sm table-striped mb-3">
								<thead>
									<tr>
										<th>Nivel</th>
										<th style="text-transform: none;">Ki</th>
										<th>ϕ</th>
										<th>Δϕ</th>
									</tr>
								</thead>
								<tbody id="lvls" class="lvls">
									<tr class="lvl-clonable d-none">
										<td class="lvl-label"></td>
										<td class="lvl-ki"></td>
										<td class="lvl-phi"></td>
										<td class="lvl-delta-phi"></td>
									</tr>
								</tbody>
							</table>
							<p>El entrepiso crítico en la dirección <span class="drt-txt"></span> es el nivel <span class="lvl-txt" /></p>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- / Content -->
	<!-- Footer -->
	<footer class="content-footer footer bg-footer-theme">
		<div class="container-xxl d-flex flex-wrap justify-content-between py-2 flex-md-row flex-column">
			<div class="mb-2 mb-md-0">
				©
				<script>
				document.write(new Date().getFullYear())
				</script> Gianella Adriana Valencia Ronquillo, Plantilla por <a href="https://themeselection.com" target="_blank" class="footer-link fw-medium">ThemeSelection</a>.
			</div>
		</div>
	</footer>
	<!-- / Footer -->
	<div class="content-backdrop fade"></div>
	</div>
	<!-- Core JS -->
	<!-- build:js assets/vendor/js/core.js -->
	<script src="../assets/vendor/libs/jquery/jquery.js"></script>
	<script src="../assets/vendor/libs/popper/popper.js"></script>
	<script src="../assets/vendor/js/bootstrap.js"></script>
	<!-- endbuild -->
	<!-- Vendors JS -->
	<!-- Main JS -->
	<script src="../assets/js/main.js"></script>
	<script>
	function Floor(floor) {
		this.floor = floor;
	}

	function Column(floor, col, b, h, hc) {
		this.floor = floor;
		this.col = col;
		this.b = b;
		this.h = h;
		this.hc = hc;
		this.ac = b * h;
		this.w = ((b * h * hc) * (2.4 * 1000 / Math.pow(100, 3)));
	}

	function Beam(floor, beam, b, h, lv) {
		this.floor = floor;
		this.beam = beam;
		this.b = b;
		this.h = h;
		this.lv = lv;
	}

	function Wall(floor, wall, lm, hm, em) {
		this.floor = floor;
		this.wall = wall;
		this.lm = lm;
		this.hm = hm;
		this.em = em;
		this.am = lm * em;
	}

	function Slab(floor, slab, ll, al, el) {
		this.floor = floor;
		this.slab = slab;
		this.ll = ll;
		this.al = al;
		this.el = el;
	}

	function DeformedShape(floors, kis) {
		var vector = {};
		switch (floors) {
			case 2:
				vector['1'] = 1;
				vector['0'] = (1.5 * kis[1]) / ((1.5 * kis[1]) + 1.5 * kis[0]);
				return vector;
			case 3:
				vector['2'] = 1;
				vector['1'] = ((2 * kis[1] * kis[2]) + (1.67 * kis[0] * kis[2])) / ((2 * kis[1] * kis[2]) + (1.67 * kis[0] * kis[2]) + (kis[0] * kis[1]));
				vector['0'] = (2 * kis[1] * kis[2]) / ((2 * kis[1] * kis[2]) + (1.67 * kis[0] * kis[2]) + (kis[0] * kis[1]));
				return vector;
			case 4:
				vector['3'] = 1;
				vector['2'] = ((2.5 * kis[1] * kis[2] * kis[3]) + (2.25 * kis[0] * kis[2] * kis[3]) + (1.75 * kis[0] * kis[1] * kis[3])) / ((2.5 * kis[1] * kis[2] * kis[3]) + (2.25 * kis[0] * kis[2] * kis[3]) + (1.75 * kis[0] * kis[1] * kis[3]) + (kis[0] * kis[1] * kis[2]));
				vector['1'] = ((2.5 * kis[1] * kis[2] * kis[3]) + (2.25 * kis[0] * kis[2] * kis[3])) / ((2.5 * kis[1] * kis[2] * kis[3]) + (2.25 * kis[0] * kis[2] * kis[3]) + (1.75 * kis[0] * kis[1] * kis[3]) + (kis[0] * kis[1] * kis[2]));
				vector['0'] = (2.5 * kis[1] * kis[2] * kis[3]) / ((2.5 * kis[1] * kis[2] * kis[3]) + (2.25 * kis[0] * kis[2] * kis[3]) + (1.75 * kis[0] * kis[1] * kis[3]) + (kis[0] * kis[1] * kis[2]));
				return vector;
			default:
				return null;
		}
	}

	$(function() {

		var data = [

			[25, 25, 250, 'F1B1', null, 'F1B7', null, null, null, null, null, 'L1'],
			[25, 75, 250, 'F1B2', 'F1B1', 'F1B9', null, null, null, null, null, 'L1'],
			[25, 25, 250, null, 'F1B2', 'F1B11', null, null, null, null, null, 'L1'],
			[25, 25, 250, 'F1B3', null, 'F1B8', 'F1B7', null, null, null, null, 'L1'],
			[25, 25, 250, 'F1B4', 'F1B3', 'F1B10', 'F1B9', null, null, null, null, 'L1'],
			[25, 25, 250, null, 'F1B4', 'F1B12', 'F1B11', null, null, null, null, 'L1'],
			[25, 25, 250, 'F1B5', null, null, 'F1B8', null, null, null, null, 'L1'],
			[25, 25, 250, 'F1B6', 'F1B5', null, 'F1B10', null, null, null, null, 'L1'],
			[25, 25, 250, null, 'F1B6', null, 'F1B12', null, null, null, null, 'L1'],
			[25, 25, 250, 'F2B1', null, 'F2B7', null, null, null, null, null, 'L2'],
			[25, 75, 250, 'F2B2', 'F2B1', 'F2B9', null, null, null, null, null, 'L2'],
			[25, 25, 250, null, 'F2B2', 'F2B11', null, null, null, null, null, 'L2'],
			[25, 25, 250, 'F2B3', null, 'F2B8', 'F2B7', null, null, null, null, 'L2'],
			[25, 25, 250, 'F2B4', 'F2B3', 'F2B10', 'F2B9', null, null, null, null, 'L2'],
			[25, 25, 250, null, 'F2B4', 'F2B12', 'F2B11', null, null, null, null, 'L2'],
			[25, 25, 250, 'F2B5', null, null, 'F2B8', null, null, null, null, 'L2'],
			[25, 25, 250, 'F2B6', 'F2B5', null, 'F2B10', null, null, null, null, 'L2'],
			[25, 25, 250, null, 'F2B6', null, 'F2B12', null, null, null, null, 'L2'],
			[25, 25, 250, 'F3B1', null, 'F3B7', null, null, null, null, null, 'L3'],
			[25, 75, 250, 'F3B2', 'F3B1', 'F3B9', null, null, null, null, null, 'L3'],
			[25, 25, 250, null, 'F3B2', 'F3B11', null, null, null, null, null, 'L3'],
			[25, 25, 250, 'F3B3', null, 'F3B8', 'F3B7', null, null, null, null, 'L3'],
			[25, 25, 250, 'F3B4', 'F3B3', 'F3B10', 'F3B9', null, null, null, null, 'L3'],
			[25, 25, 250, null, 'F3B4', 'F3B12', 'F3B11', null, null, null, null, 'L3'],
			[25, 25, 250, 'F3B5', null, null, 'F3B8', null, null, null, null, 'L3'],
			[25, 25, 250, 'F3B6', 'F3B5', null, 'F3B10', null, null, null, null, 'L3'],
			[25, 25, 250, null, 'F3B6', null, 'F3B12', null, null, null, null, 'L3']

		];

		var beamsData = {
			'F1B1': { b: 25, h: 50, lv: 300 },
			'F1B2': { b: 25, h: 50, lv: 600 },
			'F1B3': { b: 25, h: 50, lv: 300 },
			'F1B4': { b: 25, h: 50, lv: 600 },
			'F1B5': { b: 25, h: 50, lv: 300 },
			'F1B6': { b: 25, h: 50, lv: 500 },
			'F1B7': { b: 25, h: 50, lv: 500 },
			'F1B8': { b: 25, h: 50, lv: 550 },
			'F1B9': { b: 25, h: 50, lv: 400 },
			'F1B10': { b: 25, h: 50, lv: 600 },
			'F1B11': { b: 25, h: 50, lv: 400 },
			'F1B12': { b: 25, h: 50, lv: 600 },
			'F2B1': { b: 25, h: 50, lv: 300 },
			'F2B2': { b: 25, h: 50, lv: 600 },
			'F2B3': { b: 25, h: 50, lv: 300 },
			'F2B4': { b: 25, h: 50, lv: 600 },
			'F2B5': { b: 25, h: 50, lv: 300 },
			'F2B6': { b: 25, h: 50, lv: 500 },
			'F2B7': { b: 25, h: 50, lv: 500 },
			'F2B8': { b: 25, h: 50, lv: 550 },
			'F2B9': { b: 25, h: 50, lv: 400 },
			'F2B10': { b: 25, h: 50, lv: 600 },
			'F2B11': { b: 25, h: 50, lv: 400 },
			'F2B12': { b: 25, h: 50, lv: 600 },
			'F3B1': { b: 25, h: 50, lv: 300 },
			'F3B2': { b: 25, h: 50, lv: 600 },
			'F3B3': { b: 25, h: 50, lv: 300 },
			'F3B4': { b: 25, h: 50, lv: 600 },
			'F3B5': { b: 25, h: 50, lv: 300 },
			'F3B6': { b: 25, h: 50, lv: 500 },
			'F3B7': { b: 25, h: 50, lv: 500 },
			'F3B8': { b: 25, h: 50, lv: 550 },
			'F3B9': { b: 25, h: 50, lv: 400 },
			'F3B10': { b: 25, h: 50, lv: 600 },
			'F3B11': { b: 25, h: 50, lv: 400 },
			'F3B12': { b: 25, h: 50, lv: 600 }
		}

		var wallsData = {

		}

		var slabsData = {
			'L1': { ll: 1283, al: 1075, el: 15 },
			'L2': { ll: 1283, al: 1075, el: 15 },
			'L3': { ll: 1283, al: 1075, el: 15 }
		}

		// TODO
		// Add rows
		// Delete rows		
		// Listener on add, delete and change for options

		var floorsMap = {};
		var columnsMap = {};
		var beamsMap = {};
		var wallsMap = {};
		var slabsMap = {};

		$('.floors').val(3);
		$('.columns').val(9);
		$('.beams').val(12);
		$('.walls').val(0);
		$('.slabs').val(3);

		$('.columns-b').val(25);
		$('.columns-h').val(25);
		$('.columns-hc').val(250);

		$('.beams-b').val(25);
		$('.beams-h').val(50);
		$('.beams-lv').val(300);

		$('.walls-lm').val(0);
		$('.walls-hm').val(0);
		$('.walls-em').val(0);

		$('.slabs-ll').val(1283);
		$('.slabs-al').val(1075);
		$('.slabs-el').val(15);

		$('.define-model-btn').on('click', function() {

			//if(!confirm('¿Está seguro?'))
			//	return false;

			var floors = $('.floors').val();
			var columns = $('.columns').val();
			var beams = $('.beams').val();
			var walls = $('.walls').val();
			var slabs = $('.slabs').val();

			if (floors < 0 || floors > 4) {
				alert('El número de pisos no puede se menor que 0 o mayor que 4')
				return false;
			}

			$('.data').addClass('d-none');

			if (!floors || floors <= 0) {
				alert('Indicar el número de pisos');
			} else if (!columns || columns <= 0) {
				alert('Indicar el número de columnas');
			} else if (!beams || beams <= 0) {
				alert('Indicar el número de vigas');
			} else if (!walls || walls < 0) {
				alert('Indicar el número de muros de mampostería');
			} else if (!slabs || slabs <= 0) {
				alert('Indicar el número de losas');
			} else {
				var floorOpts = [];
				for (var floor = 1; floor <= floors; floor++) {
					floorOpts.push(new Option('PISO ' + floor, 'F' + floor));
					var fl = new Floor(floor);
					switch (floor) {
						case 1:
							fl.fc = 252.18;
							break;
						case 2:
							fl.fc = 272.26;
							break;
						case 3:
							fl.fc = 258.19;
							break;
					}
					if (fl.fc <= 200)
						fl.ec = 8000 * Math.sqrt(fl.fc);
					else
						fl.ec = 14000 * Math.sqrt(fl.fc);
					floorsMap['F' + floor] = fl;
				}
				$('.columns-tbl .cloned').empty();
				for (var floor = 1; floor <= floors; floor++) {
					for (var column = 1; column <= columns; column++) {
						var cloned = $('.columns-tbl .clone-target').clone()
							.removeClass('clone-target')
							.removeClass('d-none')
							.addClass('cloned');
						$.each(floorOpts, function(opt) {
							cloned.find('.cl-sl-f').append($('<option>', {
								value: floorOpts[opt].value,
								text: floorOpts[opt].text
							}));
						});
						cloned.find('.cl-sl-f').val('F' + floor);
						cloned.find('.column').val('C' + column);
						cloned.find('.column-b').val($('.columns-b').val());
						cloned.find('.column-h').val($('.columns-h').val());
						cloned.find('.column-hc').val($('.columns-hc').val());
						$('.columns-tbl tr:last').before(cloned);
						columnsMap['F' + floor + 'C' + column] = new Column(floorsMap['F' + floor], 'C' + column, $('.columns-b').val(), $('.columns-h').val(), $('.columns-hc').val());
					}
				}
				$('.beams-tbl .cloned').empty();
				for (var floor = 1; floor <= floors; floor++) {
					for (var beam = 1; beam <= beams; beam++) {
						var cloned = $('.beams-tbl .clone-target').clone()
							.removeClass('clone-target')
							.removeClass('d-none')
							.addClass('cloned');
						$.each(floorOpts, function(opt) {
							cloned.find('.bm-sl-f').append($('<option>', {
								value: floorOpts[opt].value,
								text: floorOpts[opt].text
							}));
						});
						cloned.find('.bm-sl-f').val('F' + floor);
						cloned.find('.beam').val('B' + beam);
						cloned.find('.beam').data('floor-label', 'PISO ' + floor);
						cloned.find('.beam').data('floor-value', 'F' + floor);
						cloned.find('.beam-b').val($('.beams-b').val());
						cloned.find('.beam-h').val($('.beams-h').val());
						cloned.find('.beam-lv').val($('.beams-lv').val());
						$('.beams-tbl tr:last').before(cloned);
						beamsMap['F' + floor + 'B' + beam] = new Beam(floorsMap['F' + floor], 'B' + beam, $('.beams-b').val(), $('.beams-h').val(), $('.beams-lv').val());
					}
				}
				$('.walls-tbl .cloned').empty();
				for (var floor = 1; floor <= floors; floor++) {
					for (var wall = 1; wall <= walls; wall++) {
						var cloned = $('.walls-tbl .clone-target').clone()
							.removeClass('clone-target')
							.removeClass('d-none')
							.addClass('cloned');
						$.each(floorOpts, function(opt) {
							cloned.find('.wl-sl-f').append($('<option>', {
								value: floorOpts[opt].value,
								text: floorOpts[opt].text
							}));
						});
						cloned.find('.wl-sl-f').val('F' + floor);
						cloned.find('.wall').val('W' + wall);
						cloned.find('.wall').data('floor-label', 'PISO ' + floor);
						cloned.find('.wall').data('floor-value', 'F' + floor);
						cloned.find('.wall-lm').val($('.walls-lm').val());
						cloned.find('.wall-hm').val($('.walls-hm').val());
						cloned.find('.wall-em').val($('.walls-em').val());
						$('.walls-tbl tr:last').before(cloned);
						walls['F' + floor + 'B' + beam] = new Wall(floorsMap['F' + floor], 'W' + wall, $('.walls-lm').val(), $('.walls-hm').val(), $('.walls-em').val());
					}
				}
				if (walls > 0) {
					$('.walls-tbl').parent().removeClass('d-none');
				}
				$('.slabs-tbl .cloned').empty();
				for (var slab = 1; slab <= slabs; slab++) {
					var cloned = $('.slabs-tbl .clone-target').clone()
						.removeClass('clone-target')
						.removeClass('d-none')
						.addClass('cloned');
					$.each(floorOpts, function(opt) {
						cloned.find('.sb-sl-f').append($('<option>', {
							value: floorOpts[opt].value,
							text: floorOpts[opt].text
						}));
					});
					cloned.find('.sb-sl-f').val('F' + slab);
					cloned.find('.slab').val('L' + slab);
					cloned.find('.slab').data('floor-label', 'PISO ' + slab);
					cloned.find('.slab').data('floor-value', 'L' + slab);
					cloned.find('.slab-ll').val($('.slabs-ll').val());
					cloned.find('.slab-al').val($('.slabs-al').val());
					cloned.find('.slab-el').val($('.slabs-el').val());
					$('.slabs-tbl tr:last').before(cloned);
					slabsMap['S' + slab] = new Slab(floorsMap['F' + slab], slab, $('.slabs-ll').val(), $('.slabs-al').val(), $('.slabs-el').val());
				}
				$('.beam').first().trigger('change');
				$('.wall').first().trigger('change');
				$('.slab').first().trigger('change');
				$('.data').removeClass('d-none');
				$('.initialize-model-btn').removeClass('d-none');
			}

		});

		$('body').on('change', '.beam', function() {

			var opts = [new Option('', null)];

			$('.beam').each(function() {
				if ($(this).data('floor-value')) {
					var text = $(this).data('floor-label') + ' - ' + $(this).val();
					var value = $(this).data('floor-value') + $(this).val();
					opts.push(new Option(text, value));
				}
			});

			$('.cl-sl-b').empty();

			$.each(opts, function(opt) {
				$('.cl-sl-b').append(opts[opt]);
			});

		});

		$('body').on('change', '.wall', function() {

			var opts = [new Option('', null)];

			$('.wall').each(function() {
				if ($(this).data('floor-value')) {
					var text = $(this).data('floor-label') + ' - ' + $(this).val();
					var value = $(this).data('floor-value') + $(this).val();
					opts.push(new Option(text, value));
				}
			});

			$('.cl-sl-w').empty();

			$.each(opts, function(opt) {
				$('.cl-sl-w').append(opts[opt]);
			});

		});

		$('body').on('change', '.slab', function() {

			var opts = [new Option('', null)];

			$('.slab').each(function() {
				if ($(this).data('floor-value')) {
					var text = $(this).data('floor-label') + ' - ' + $(this).val();
					var value = $(this).data('floor-value');
					opts.push(new Option(text, value));
				}
			});

			$('.cl-sl-s').empty();

			$.each(opts, function(opt) {
				$('.cl-sl-s').append(opts[opt]);
			});

		});

		$('.initialize-model-btn').on('click', function() {

			$('.columns-tbl .cloned').each(function(idx) {
				var row = $(this);
				var column = data[idx];
				if (column) {
					row.find('.column-b').val(column[0]);
					row.find('.column-h').val(column[1]);
					row.find('.column-hc').val(column[2]);
					row.find('.column-b-r').val(column[3]);
					row.find('.column-b-l').val(column[4]);
					row.find('.column-b-t').val(column[5]);
					row.find('.column-b-b').val(column[6]);
					row.find('.column-w-r').val(column[7]);
					row.find('.column-w-l').val(column[8]);
					row.find('.column-w-t').val(column[9]);
					row.find('.column-w-b').val(column[10]);
					row.find('.column-s').val(column[11]);
				}
			});

			$('.beams-tbl .cloned').each(function(idx) {
				var row = $(this);
				if (row.find('.beam').data('floor-value')) {
					var beam = beamsData[row.find('.beam').data('floor-value') + row.find('.beam').val()];
					if (beam) {
						row.find('.beam-b').val(beam.b);
						row.find('.beam-h').val(beam.h);
						row.find('.beam-lv').val(beam.lv);
					}
				}
			});

			$('.initialize-model-btn').addClass('d-none');

		});

		$('.calculate-model-btn').on('click', function() {

			slabsMap = {};

			$('.slabs-tbl .cloned').each(function() {
				var row = $(this);
				var floor = row.find('.sb-sl-f').val();
				var slab = row.find('.slab').val();
				var slabLL = row.find('.slab-ll').val();
				var slabAL = row.find('.slab-al').val();
				var slabEL = row.find('.slab-el').val();
				slabsMap[slab] = new Slab(floorsMap[floor], slab, slabLL, slabAL, slabEL);
			});

			beamsMap = {};

			$('.beams-tbl .cloned').each(function() {
				var row = $(this);
				var floor = row.find('.bm-sl-f').val();
				var beam = row.find('.beam').val();
				var beamB = row.find('.beam-b').val();
				var beamH = row.find('.beam-h').val();
				var beamLV = row.find('.beam-lv').val();
				beamsMap[floor + beam] = new Beam(floorsMap[floor], beam, beamB, beamH, beamLV);
			});

			wallsMap = {};

			$('.walls-tbl .cloned').each(function() {
				var row = $(this);
				var floor = row.find('.wl-sl-f').val();
				var wall = row.find('.wall').val();
				var wallLM = row.find('.wall-lm').val();
				var wallHM = row.find('.wall-hm').val();
				var beamEM = row.find('.wall-em').val();
				wallsMap[floor + wall] = new Wall(floorsMap[floor], wall, wallLM, wallHM, beamEM);
			});

			columnsMap = {};
			kiMap = {}

			$('.columns-tbl .cloned').each(function(idx) {
				var row = $(this);
				var floor = row.find('.cl-sl-f').val();
				var col = row.find('.column').val();
				var colB = row.find('.column-b').val();
				var colH = row.find('.column-h').val();
				var colHC = row.find('.column-hc').val();
				var column = new Column(floorsMap[floor], col, colB, colH, colHC);
				column.br = beamsMap[row.find('.column-b-r').val()];
				column.bl = beamsMap[row.find('.column-b-l').val()];
				column.bt = beamsMap[row.find('.column-b-t').val()];
				column.bb = beamsMap[row.find('.column-b-b').val()];
				column.bw = 0;
				if (column.br)
					column.bw += ((column.br.b * column.br.h * column.br.lv) / 2);
				if (column.bl)
					column.bw += ((column.bl.b * column.bl.h * column.bl.lv) / 2);
				if (column.bt)
					column.bw += ((column.bt.b * column.bt.h * column.bt.lv) / 2);
				if (column.bb)
					column.bw += ((column.bb.b * column.bb.h * column.bb.lv) / 2);
				column.bw = column.bw * (2.4 * 1000 / Math.pow(100, 3));
				column.wr = wallsMap[row.find('.column-w-r').val()];
				column.wl = wallsMap[row.find('.column-w-l').val()];
				column.wt = wallsMap[row.find('.column-w-t').val()];
				column.wb = wallsMap[row.find('.column-w-b').val()];
				column.ww = 0;
				if (column.wr)
					column.ww += ((column.wr.lm * column.wr.hm * column.wr.em) / 2);
				if (column.wl)
					column.ww += ((column.wl.lm * column.wl.hm * column.wl.em) / 2);
				if (column.wt)
					column.ww += ((column.wt.lm * column.wt.hm * column.wt.em) / 2);
				if (column.wb)
					column.ww += ((column.wb.lm * column.wb.hm * column.wb.em) / 2);
				column.ww = column.ww * (1.9 * 1000 / Math.pow(100, 3));
				column.s = slabsMap[row.find('.column-s').val()];
				column.at = 0;
				var brlv = 0;
				var bllv = 0;
				var btlv = 0;
				var bblv = 0;
				if (column.br)
					brlv = column.br.lv;
				if (column.bl)
					bllv = column.bl.lv;
				if (column.bt)
					btlv = column.bt.lv;
				if (column.bb)
					bblv = column.bb.lv;
				column.at = ((brlv / 2) + (bllv / 2)) * ((btlv / 2) + (bblv / 2));
				column.sw = (column.at) * column.s.el * (2.4 * 1000 / Math.pow(100, 3));
				column.scd = 0.02;
				column.scdw = column.scd * column.at;
				column.l = 0.005;
				column.lw = column.l * column.at;
				column.pg = column.w + column.bw + column.ww + column.sw + column.scdw + column.lw;
				column.pga = column.pg * (Object.keys(floorsMap).length - (column.floor.floor - 1));
				column.v = column.pga / (column.b * column.h * column.floor.fc);
				if (column.v >= 0.1)
					column.alpha = 0.5;
				else
					column.alpha = 0.33;
				column.fm = 20;
				column.uy = 2;
				column.ty = 0.2 / 100;
				// TODO 
				// Controlar desplazamiento en X o en Y
				var tmpVal = column.b;
				column.kcol = ((column.ac * column.alpha * column.floor.ec) / column.hc) * Math.pow((tmpVal / column.hc), 2);
				// TODO 
				// Revisar cálculo contra el excel
				if (column.wr && column.wl)
					column.kmur = (((column.wr.am / 2) + (column.wl.am / 2)) / column.hc) *
					((0.1 * column.fm) /
						(column.uy * column.ty * Math.sqrt((1 + (Math.pow(column.wr.hm, 2) + Math.pow(column.wl.hm, 2))) / (
							(Math.pow(column.wr.lm / 2, 2) + Math.pow(column.wl.lm / 2, 2))))));
				else
					column.kmur = 0;
				column.ki = column.kcol + column.kmur;
				if (kiMap[column.floor.floor] == undefined) {
					kiMap[column.floor.floor] = 0;
				}
				kiMap[column.floor.floor] += column.ki;
				columnsMap[floor + col] = column;
			});

			$('.beams-tbl .cloned').each(function(idx) {
				var row = $(this);
				if (row.find('.beam').data('floor-value')) {
					var beam = beamsData[row.find('.beam').data('floor-value') + row.find('.beam').val()];
					if (beam) {
						row.find('.beam-b').val(beam.b);
						row.find('.beam-h').val(beam.h);
						row.find('.beam-lv').val(beam.lv);
					}
				}
			});

			console.log(kiMap);
			console.log(columnsMap);
			var kis = [];

			for (const [key, value] of Object.entries(kiMap)) {
				kis.push(value);
			}

			//kis = kis.reverse();

			console.log(kis);

			var deformedShape = new DeformedShape(Number($('.floors').val()), kis);

			console.log(deformedShape);

			var lvls = $('.floors').val();
			var max = 0;

			$('.lvls .lvl').remove();

			for (i = 1; i <= $('.floors').val(); i++) {
				var row = $('.lvl-clonable').clone().removeClass().addClass('lvl');
				row.find('.lvl-label').text(i);
				row.find('.lvl-ki').text(Number.parseFloat(kiMap[i]).toFixed(5));
				row.find('.lvl-phi').text(Number.parseFloat(deformedShape[i - 1]).toFixed(3));
				var delta = i == 1 ? Number.parseFloat(deformedShape[i - 1]).toFixed(3) :
					Number.parseFloat(deformedShape[i - 1] - deformedShape[i - 2]).toFixed(3);
				if (delta > max)
					max = i;
				row.find('.lvl-delta-phi').text(delta);
				row.appendTo($('.lvls'));
			}

			var table = document.getElementById('lvls'),
				rows = table.rows;

			for (var i = 0; i < rows.length; i++) {
				rows[i].parentNode.insertBefore(rows[rows.length - 1], rows[i]);
			}

			$('.drt-txt').text('X');
			$('.lvl-txt').text(max);

			$('.step-i').removeClass('d-none');

		});


	});
	</script>
</body>

</html>